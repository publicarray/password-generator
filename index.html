<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Generator</title>
    <meta name="author" content="@publicarray (Sebastian Schmidt)">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/apple-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
    <link rel="icon" type="image/avif" sizes="96x96" href="icons/favicon-96x96.avif">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="manifest" href="manifest.json">
        <style>
        :root { /* light ‚òÄÔ∏è */
            color-scheme: light dark;
            --font-color: #000;
            --bg-color: #f1f1f1;
        }
        /* https://caniuse.com/#feat=prefers-color-scheme */
        @media (prefers-color-scheme: dark) {
            :root { /* dark üåò */
                --font-color: #e6eaea;
                --bg-color: #222326;
            }
        }

        body {
            text-align: center;
            font-size: 1.6rem;
            font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif;
            background: var(--bg-color);
            color: var(--font-color);
            transition: color ease 0.5s, background ease 0.5s;
        }
        label {
            margin-left: 2rem;
        }

        #out {
            overflow-wrap: anywhere;
        }
    </style>
</head>
<body>
    <form action="" method="get" oninput="start()">
        <label for="numbers">Numbers</label>
        <input type="checkbox" name="numbers" id="numbers" checked>
        <label for="special">Special</label>
        <input type="checkbox" name="special" id="special">
        <label for="emoji">Emoji</label>
        <input type="checkbox" name="emoji" id="emoji">
        <label for="length">Length</label>
        <input type="number" name="length" id="length" min="1" value="20">
    </form>
    <h2 id="out"></h2>
    <form action="" method="get" oninput="startWords()">
        <label for="words">Number of Words</label>
        <input type="number" name="words" id="words" min="1" value="4">
    </form>
    <h2 id="wordsOut"></h2>
    <script>
        const d = document
        const alpha = [...'abcdefghijklmnopqrstovwxyz']
        const alphaUpper = [...'ABCDEFGHIJKLMNOPQRSTOVWXYZ']
        const num = [...'0123456789']
        const specials = [...'~!@#$%^&*()_+-={}[]|;\':",./<>?\\`']
        // https://gist.github.com/ikr7/c72843556ef3a12014c3
        const emojis = [...'üòÑüòÉüòÄüòä‚ò∫üòâüòçüòòüòöüòóüòôüòúüòùüòõüò≥üòÅüòîüòåüòíüòûüò£üò¢üòÇüò≠üò™üò•üò∞üòÖüòìüò©üò´üò®üò±üò†üò°üò§üòñüòÜüòãüò∑üòéüò¥üòµüò≤üòüüò¶üòßüòàüëøüòÆüò¨üòêüòïüòØüò∂üòáüòèüòëüë≤üë≥üëÆüë∑üíÇüë∂üë¶üëßüë®üë©üë¥üëµüë±üëºüë∏üò∫üò∏üòªüòΩüòºüôÄüòøüòπüòæüëπüë∫üôàüôâüôäüíÄüëΩüí©üî•‚ú®üåüüí´üí•üí¢üí¶üíßüí§üí®üëÇüëÄüëÉüëÖüëÑüëçüëéüëåüëä‚úä‚úåüëã‚úãüëêüëÜüëáüëâüëàüôåüôè‚òùüëèüí™üö∂üèÉüíÉüë´üë™üë¨üë≠üíèüíëüëØüôÜüôÖüíÅüôãüíÜüíáüíÖüë∞üôéüôçüôáüé©üëëüëíüëüüëûüë°üë†üë¢üëïüëîüëöüëóüéΩüëñüëòüëôüíºüëúüëùüëõüëìüéÄüåÇüíÑüíõüíôüíúüíö‚ù§üíîüíóüíìüíïüíñüíûüíòüíåüíãüíçüíéüë§üë•üí¨üë£üí≠üê∂üê∫üê±üê≠üêπüê∞üê∏üêØüê®üêªüê∑üêΩüêÆüêóüêµüêíüê¥üêëüêòüêºüêßüê¶üê§üê•üê£üêîüêçüê¢üêõüêùüêúüêûüêåüêôüêöüê†üêüüê¨üê≥üêãüêÑüêèüêÄüêÉüêÖüêáüêâüêéüêêüêìüêïüêñüêÅüêÇüê≤üê°üêäüê´üê™üêÜüêàüê©üêæüíêüå∏üå∑üçÄüåπüåªüå∫üçÅüçÉüçÇüåøüåæüçÑüåµüå¥üå≤üå≥üå∞üå±üåºüåêüåûüåùüåöüåëüåíüåìüåîüåïüåñüåóüåòüåúüåõüåôüåçüåéüåèüåãüååüå†‚≠ê‚òÄ‚õÖ‚òÅ‚ö°‚òî‚ùÑ‚õÑüåÄüåÅüåàüåäüéçüíùüééüéíüéìüéèüéÜüéáüéêüéëüéÉüëªüéÖüéÑüéÅüéãüéâüéäüéàüéåüîÆüé•üì∑üìπüìºüíøüìÄüíΩüíæüíªüì±‚òéüìûüìüüì†üì°üì∫üìªüîäüîâüîàüîáüîîüîïüì¢üì£‚è≥‚åõ‚è∞‚åöüîìüîíüîèüîêüîëüîéüí°üî¶üîÜüîÖüîåüîãüîçüõÅüõÄüöøüöΩüîßüî©üî®üö™üö¨üí£üî´üî™üíäüíâüí∞üí¥üíµüí∑üí∂üí≥üí∏üì≤üìßüì•üì§‚úâüì©üì®üìØüì´üì™üì¨üì≠üìÆüì¶üìùüìÑüìÉüìëüìäüìàüìâüìúüìãüìÖüìÜüìáüìÅüìÇ‚úÇüìåüìé‚úí‚úèüìèüìêüìïüìóüìòüìôüììüìîüìíüìöüìñüîñüìõüî¨üî≠üì∞üé®üé¨üé§üéßüéºüéµüé∂üéπüéªüé∫üé∑üé∏üëæüéÆüÉèüé¥üÄÑüé≤üéØüèàüèÄ‚öΩ‚öæüéæüé±üèâüé≥‚õ≥üöµüö¥üèÅüèáüèÜüéøüèÇüèäüèÑüé£‚òïüçµüç∂üçºüç∫üçªüç∏üçπüç∑üç¥üçïüçîüçüüçóüçñüçùüçõüç§üç±üç£üç•üçôüçòüçöüçúüç≤üç¢üç°üç≥üçûüç©üçÆüç¶üç®üçßüéÇüç∞üç™üç´üç¨üç≠üçØüçéüçèüçäüçãüçíüçáüçâüçìüçëüçàüçåüçêüççüç†üçÜüçÖüåΩüè†üè°üè´üè¢üè£üè•üè¶üè™üè©üè®üíí‚õ™üè¨üè§üåáüåÜüèØüè∞‚õ∫üè≠üóºüóæüóªüåÑüåÖüåÉüóΩüåâüé†üé°‚õ≤üé¢üö¢‚õµüö§üö£‚öìüöÄ‚úàüí∫üöÅüöÇüöäüöâüöûüöÜüöÑüöÖüöàüöáüöùüöãüöÉüöéüöåüöçüöôüöòüöóüöïüöñüöõüööüö®üöìüöîüöíüöëüöêüö≤üö°üöüüö†üöúüíàüöèüé´üö¶üö•‚ö†üößüî∞‚õΩüèÆüé∞‚ô®üóøüé™üé≠üìçüö©‚¨Ü‚¨á‚¨Ö‚û°üî†üî°üî§‚Üó‚Üñ‚Üò‚Üô‚Üî‚ÜïüîÑ‚óÄ‚ñ∂üîºüîΩ‚Ü©‚Ü™‚Ñπ‚è™‚è©‚è´‚è¨‚§µ‚§¥üÜóüîÄüîÅüîÇüÜïüÜôüÜíüÜìüÜñüì∂üé¶üàÅüàØüà≥üàµüà¥üà≤üâêüàπüà∫üà∂üàöüöªüöπüö∫üöºüöæüö∞üöÆüÖø‚ôøüö≠üà∑üà∏üàÇ‚ìÇüõÇüõÑüõÖüõÉüâë„äô„äóüÜëüÜòüÜîüö´üîûüìµüöØüö±üö≥üö∑üö∏‚õî‚ú≥‚ùá‚ùé‚úÖ‚ú¥üíüüÜöüì≥üì¥üÖ∞üÖ±üÜéüÖæüí†‚ûø‚ôª‚ôà‚ôâ‚ôä‚ôã‚ôå‚ôç‚ôé‚ôè‚ôê‚ôë‚ôí‚ôì‚õéüîØüèßüíπüí≤üí±¬©¬Æ‚Ñ¢„ÄΩ„Ä∞üîùüîöüîôüîõüîú‚ùå‚≠ï‚ùó‚ùì‚ùï‚ùîüîÉüïõüïßüïêüïúüïëüïùüïíüïûüïìüïüüïîüï†üïïüïñüïóüïòüïôüïöüï°üï¢üï£üï§üï•üï¶‚úñ‚ûï‚ûñ‚ûó‚ô†‚ô•‚ô£‚ô¶üíÆüíØ‚úî‚òëüîòüîó‚û∞üî±üî≤üî≥‚óº‚óª‚óæ‚óΩ‚ñ™‚ñ´üî∫‚¨ú‚¨õ‚ö´‚ö™üî¥üîµüîªüî∂üî∑üî∏üîπ']

        // check url parameter and set defaults
        const { searchParams } = new URL(d.URL)
        if (searchParams.has('numbers')) {
            let value = searchParams.get('numbers').toLowerCase() == 'true' ? true : false;
            d.getElementById('numbers').checked = value
        }
        if (searchParams.has('special')) {
            let value = searchParams.get('special').toLowerCase() == 'true' ? true : false;
            d.getElementById('special').checked = value
        }
        if (searchParams.has('emoji')) {
            let value = searchParams.get('emoji').toLowerCase() == 'true' ? true : false;
            d.getElementById('emoji').checked = value
        }
        if (searchParams.has('length')) {
            d.getElementById('length').value = searchParams.get('length')
        }
        if (searchParams.has('words')) {
            d.getElementById('words').value = searchParams.get('words')
        }


        function start() {
            let numbers = d.getElementById('numbers').checked
            let special = d.getElementById('special').checked
            let emoji = d.getElementById('emoji').checked
            let length = d.getElementById('length').value
            let out = d.getElementById('out')
            out.innerText  = genPassword(numbers, special, emoji, length)

            // Update URL parameters
            searchParams.set('numbers', d.getElementById('numbers').checked)
            searchParams.set('special', d.getElementById('special').checked)
            searchParams.set('emoji', d.getElementById('emoji').checked)
            searchParams.set('length', d.getElementById('length').value)
            history.replaceState(null, '', `${location.pathname}?${searchParams}`)
        }

        function startWords() {
            let password = ""
            let numOfWords = d.getElementById('words').value
            let out = d.getElementById('wordsOut')
            getDictionary(dictionary => {
                for (let i = 0; i < numOfWords; i++) {
                    let randomNumber = Math.floor(random() * dictionary.length)
                    if (i == numOfWords-1) {
                        password += dictionary[randomNumber]
                    } else {
                        password += dictionary[randomNumber] + "-"
                    }
                }
                out.innerText = password
            })


            // Update URL parameters
            searchParams.set('words', d.getElementById('words').value)
            history.replaceState(null, '', `${location.pathname}?${searchParams}`)
        }

        // use the crypto API instead of Math.random
        function random() {
            // 32bit = 2**32-1 or 0xffffffff = 4294967295
            return crypto.getRandomValues(new Uint32Array(1))[0] / 0xffffffff
        }

        // function stringFromUTF8Array(data) {
        //     let str = "";
        //     for (let i = 0 ; i < data.length; i++) {
        //         str += String.fromCharCode(data[i]);
        //     }
        //     return str;
        // }

        function randomChar (searchSpace) {
            // let randomNumber = Math.floor(Math.random() * searchSpace.length)
            let randomNumber = Math.floor(random() * searchSpace.length)
            return searchSpace[randomNumber]
        }

        function genPassword(numbers, special, emoji, length) {
            let password = ""
            let searchSpace = []
            searchSpace = searchSpace.concat(alpha)
            searchSpace = searchSpace.concat(alphaUpper)
            if (numbers) {
                searchSpace = searchSpace.concat(num)
            }
            if (special) {
                searchSpace = searchSpace.concat(specials)
            }
            if (emoji) {
                searchSpace = searchSpace.concat(emojis)
            }
            for (let i = 0; i < length; i++) {
                // str = stringFromUTF8Array(crypto.getRandomValues(new Uint32Array(1)))
                // if (str) {
                //     password += str
                // } else {
                //     i--
                // }
                password += randomChar(searchSpace)
            }
            return password
        }

        function getDictionary(callback) {
            // https://eff.org/dice
            // wget https://www.eff.org/files/2016/07/18/eff_large_wordlist.txt
            // cat eff_large_wordlist.txt | awk '{print $2}' > eff.txt

            // https://github.com/first20hours/google-10000-english
            fetch('eff.txt')
                .then(response => response.text())
                .then(data => callback(data.split('\n')))
        }

        start()
        startWords()

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
        }
    </script>

</body>
</html>
